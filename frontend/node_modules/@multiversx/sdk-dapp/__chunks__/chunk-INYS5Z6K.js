import{b as e}from"./chunk-24AN3Y2V.js";import{a as D}from"./chunk-YAR2KJ42.js";import{a as g}from"./chunk-QGGNJI27.js";import{a as k}from"./chunk-FAVYLC7T.js";import{c as A}from"./chunk-KLQ5IZ6C.js";import{a as C}from"./chunk-KZR7TQ7H.js";import{s as M}from"./chunk-SFJMMIST.js";import{b as u}from"./chunk-2RJZ73G3.js";import{a,d as G}from"./chunk-EVEX5BE5.js";import{a as Z}from"./chunk-MPMLX57E.js";import{l as p,m as b}from"./chunk-7UBLQIEN.js";import{j as N,m as E}from"./chunk-HBP5N4FR.js";E();import{useCallback as P,useEffect as O,useRef as w}from"react";import{io as B}from"socket.io-client";M();Z();G();var v=3e3,S=3,W=500,_=1e3,L="batchUpdated",R="connect",h="connect_error",z="disconnect",T=0;function oe(){let r=w(null),c=w(null),{address:s}=k(),l=A(),{network:m}=g(),y=t=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{l(p(t))},_)},U=t=>{c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{l(b(t))},_)},f=()=>{var t,n,i,o;(t=e.current)==null||t.off(h),(n=e.current)==null||n.off(R),(i=e.current)==null||i.off(L),(o=e.current)==null||o.close(),e.current=null,e.status="NOT_INITIALIZED",r.current&&clearTimeout(r.current),c.current&&clearTimeout(c.current)},I=()=>{setTimeout(()=>{var n;let{address:t}=u(a.getState());if(t&&t===s){e.status="PENDING",(n=e.current)==null||n.connect();return}e.status==="PENDING"&&(e.status="NOT_INITIALIZED")},W)},d=P(C(()=>N(this,null,function*(){var i;let{address:t}=u(a.getState());if(!t){e.status="NOT_INITIALIZED";return}e.status="PENDING";let n=(i=m.websocketUrl)!=null?i:yield D(m.apiAddress);if(n==null){console.warn("Can not get websocket url"),e.status="NOT_INITIALIZED";return}e.current=B(n,{forceNew:!0,reconnection:!0,reconnectionAttempts:S,timeout:v,query:{address:t}}),e.current.onAny(y),e.current.on(L,U),e.current.on(R,()=>{console.info("Websocket connected."),e.status="COMPLETED"}),e.current.on(h,o=>{console.warn("Websocket connect error: ",o.message),t&&T<S?(T++,I()):(T=0,e.status="NOT_INITIALIZED")}),e.current.on(z,()=>{let{address:o}=u(a.getState());o?(console.warn("Websocket disconnected. Trying to reconnect..."),I()):(console.warn("Websocket disconnected."),e.status="NOT_INITIALIZED")})}),{retries:2,delay:W}),[s]);O(()=>{var t;if(!s&&e.current){console.info("Logged out. Unsubscribing websocket"),f();return}s&&e.status==="NOT_INITIALIZED"&&!((t=e.current)!=null&&t.active)&&(console.info("Logged in. Initializing websocket connection"),d())},[s,d]),O(()=>()=>{f()},[])}export{oe as a};
//# sourceMappingURL=chunk-INYS5Z6K.js.map
