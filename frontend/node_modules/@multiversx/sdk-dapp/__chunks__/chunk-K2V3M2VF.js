import{a as te}from"./chunk-R5ZOBQLY.js";import{a as Z}from"./chunk-5C4GAWRH.js";import{a as Y}from"./chunk-Q2AR5236.js";import{a as ee}from"./chunk-4ZTSYZ6M.js";import{a as K,d as Q}from"./chunk-WXDNXHED.js";import{d as J}from"./chunk-RFKFTNQQ.js";import{c as j,d as q}from"./chunk-KLQ5IZ6C.js";import{s as Ee}from"./chunk-SFJMMIST.js";import{g as V}from"./chunk-2RJZ73G3.js";import{a as ke}from"./chunk-MPMLX57E.js";import{a as T,c as U,d as _,g as S,h as $}from"./chunk-7UBLQIEN.js";import{d as X}from"./chunk-6CPM3VCF.js";import{a as xe}from"./chunk-Z3FCAX26.js";import{a as B}from"./chunk-J42ZO72F.js";import{a as P}from"./chunk-75SQ7UW4.js";import{b as v,c as Pe}from"./chunk-6NZ6PUBT.js";import{h as R,j as Se}from"./chunk-7YHU2LQD.js";import{p as Te}from"./chunk-EOZJRV5E.js";import{a as N,b as O,j as c,k as F,m as W}from"./chunk-HBP5N4FR.js";W();Se();import{useEffect as oe,useState as ne}from"react";import{HWProvider as ie}from"@multiversx/sdk-hw-provider";Pe();Ee();ke();Te();xe();var f="Check if the MultiversX App is open on Ledger",je=({callbackRoute:x,token:re,addressesPerPage:L,nativeAuth:k,onLoginRedirect:E})=>{let z=q(V),i=Q(),a=j(),b=Z(),se=k!=null,m=Y(k),l=re,{accounts:r,setAccounts:ae,isLoading:C,setIsLoading:s,setShowAddressList:h,showAddressList:A,startIndex:u,selectedAddress:d,onGoToPrevPage:de,onGoToNextPage:ce,onGoToSpecificPage:le,onSelectAddress:ge,error:y,setError:p,defaultAddressesPerPage:fe}=te(),ue=L!=null?L:fe,[H,pe]=ne(""),[G,Le]=ne(!1),D=({address:e,index:t,signature:o})=>{a(X({index:t,loginType:"ledger"})),o&&m.setTokenLoginInfo({signature:o,address:e}),a(v({address:e,loginMethod:"ledger"})),P({callbackRoute:x,onLoginRedirect:E,options:{address:e,signature:o}})},n=(e,t="")=>{var o;if(C){let{errorMessage:I,defaultErrorMessage:Ie}=B(e),ve=(o=I!=null?I:Ie)!=null?o:f;p(`${ve}.${t}`),s(!1),a(S(null))}},g=()=>c(void 0,null,function*(){try{if(i instanceof ie&&i.isInitialized())return i.isConnected()}catch(e){n(e)}return!1}),me=()=>c(void 0,null,function*(){if(yield g()){p(""),s(!1);return}try{let t=new ie;(yield t.init())&&K(t),p(""),s(!1)}catch(t){n(t)}}),he=()=>c(void 0,null,function*(){let e=yield g();if(!d||!e)return n(f);let{index:t}=d;if(se&&!l&&(l=yield m.getNativeAuthLoginToken(),!l)){console.warn("Fetching block failed. Login cancelled.");return}if(l){m.setLoginToken(l);try{let o=yield i.tokenLogin({token:F.Buffer.from(`${l}{}`),addressIndex:t});D({address:o.address,index:t,signature:o.signature.toString("hex")})}catch(o){n(o,". Update MultiversX App to continue.")}}else try{let{address:o}=yield i.login({addressIndex:t});D({address:o,index:t})}catch(o){return n(o),!1}return!0}),Ae=()=>c(void 0,null,function*(){try{if(s(!0),d==null)return!1;a(z?$(d):S(O(N({},d),{version:H,hasContractDataEnabled:G}))),s(!1),yield he()}catch(e){n(e)}return h(!1),!0}),M=()=>c(void 0,null,function*(){if(!(yield g()))return n(y);try{s(!0);let t=yield i.getAccounts(u,ue),o=yield J(i);pe(o.version),Le(o.dataEnabled),ae(t),s(!1)}catch(t){n(t)}}),ye=()=>c(void 0,null,function*(){if(b)throw new Error(R);ee(),a(_(T.address)),a(U(T)),p("");try{if(s(!0),!(yield g()))return n(f);if(z!=null){if(!d)return n(f);let{address:t}=yield i.login({addressIndex:d.index.valueOf()});if(!t)return n("Login cancelled.");a(v({address:t,loginMethod:"ledger"})),P({callbackRoute:x,onLoginRedirect:E})}else r!=null&&r.length||(yield M()),h(!0);s(!1)}catch(e){n(e)}}),we=()=>c(void 0,null,function*(){try{let e=yield g();if(e||(yield me()),e=yield g(),!e)return n(f);(r.length===0||u>=0)&&(yield M())}catch(e){n(e)}});oe(()=>{we()},[u,A,i]),oe(()=>{(r==null?void 0:r.length)>0&&!A&&h(!0)},[r]);let w=Boolean(y);return[ye,{loginFailed:w,isLoggedIn:b&&!w,error:y,isLoading:C&&!w},{accounts:r,showAddressList:A,startIndex:u,selectedAddress:d,version:H,contractDataEnabled:G,onGoToPrevPage:de,onGoToNextPage:ce,onGoToSpecificPage:le,onSelectAddress:ge,onConfirmSelectedAddress:Ae}]};export{je as a};
//# sourceMappingURL=chunk-K2V3M2VF.js.map
