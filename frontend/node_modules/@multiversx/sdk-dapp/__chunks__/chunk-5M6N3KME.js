import{a as en}from"./chunk-GU2AHFZD.js";import{a as rn}from"./chunk-42LRJZZR.js";import{a as tn}from"./chunk-I2YCVINV.js";import{a as R}from"./chunk-DZOH4YZ6.js";import{a as nn}from"./chunk-DI7674Q7.js";import{a as C,b as Pn}from"./chunk-XNFCZFZP.js";import{a as $,b as bn}from"./chunk-J42ZO72F.js";import{x as vn}from"./chunk-KM2BXRAX.js";import{i as Z}from"./chunk-7YHU2LQD.js";import{l as L}from"./chunk-E4ZF3CDC.js";import{a as o,b as P,j as N,m as X}from"./chunk-HBP5N4FR.js";X();import{useEffect as sn,useState as S}from"react";import{Address as on,Transaction as Nn,TransactionOptions as xn,TransactionVersion as An}from"@multiversx/sdk-core";vn();bn();Pn();var D={},_n=({isLedger:E=!1,transactionsToSign:x,egldLabel:an,address:y,activeGuardianAddress:I,hasGuardianScreen:cn,onCancel:f,onSignTransaction:un,onTransactionsSignError:ln,onTransactionsSignSuccess:k,onGetScamAddressData:U})=>{var q,z,J,K;let M=Boolean(I),[c,p]=S(0),[T,G]=S(),[t,W]=S(null),[w,V]=S({}),[dn,F]=S(!1),{getTxInfoByDataField:pn,allTransactions:l}=en({transactions:I?x==null?void 0:x.map(n=>{n.sender=on.newFromBech32(y),n.version=An.withTxOptions().valueOf(),n.guardian=on.newFromBech32(I);let e=o({guarded:!0},E?{hashSign:!0}:{});return n.options=xn.withOptions(e).valueOf(),n}):x}),[h,_]=S(l),O=c===h.length-1,A=h[c],v=(q=t==null?void 0:t.transaction)==null?void 0:q.sender.toBech32(),{data:j}=nn(!v||v===y?null:v),gn=()=>N(void 0,null,function*(){var Q;if(A==null)return;let{transaction:n,multiTxData:e,transactionIndex:i}=A,m=n.data.toString(),d=pn(n.data.toString(),e),{tokenId:g}=d,a=n.receiver.toBech32();if(v&&v!==y&&!tn(j,y))return console.error(Z),f==null?void 0:f();let u=y!==a,s=a in D;if(a&&u&&!s&&U!=null){let b=yield U(a);D=o(o({},D),b!=null&&b.scamInfo?{[a]:b.scamInfo}:{})}let r=Boolean(g&&C({tokenId:g,erdLabel:an})),yn=A.needsSigning,hn=n.getNonce().valueOf();W({transaction:n,ppu:w[Number(hn)].ppu||L,receiverScamInfo:((Q=D[a])==null?void 0:Q.info)||null,transactionTokenInfo:d,isTokenTransaction:r,dataField:m,transactionIndex:i,needsSigning:yn})}),fn=n=>{let e=h[c].transaction,i=e.getNonce().valueOf(),m=w[Number(i)].ppu,d=w[Number(i)].initialGasPrice;if(m===n)return;V(s=>{let r=o({},s);return r[Number(i)]=P(o({},r[Number(i)]),{ppu:n}),r});let g=n?rn({transactionDataLength:e.data.length,transactionGasLimit:Number(e.gasLimit),ppu:n}):d,a=Nn.fromPlainObject(P(o({},e.toPlainObject()),{gasPrice:g})),u=P(o({},h[c]),{transaction:a});_(s=>{let r=[...s];return r[c]=u,r}),W(s=>s&&P(o({},s),{transaction:a,ppu:n}))};sn(()=>{let n={};l.forEach(e=>{let i=e.transaction.nonce;n[Number(i)]={initialGasPrice:Number(e.transaction.gasPrice),ppu:L}}),V(n),_(l)},[l]),sn(()=>{gn()},[A,j]);let B=()=>{p(0),G(void 0),F(!1)},H=()=>N(void 0,null,function*(){let n=Object.values(T!=null?T:{}),e=R({isGuarded:M,transactions:n});if(M&&e){k(n),B();return}if(t==null)return;F(E);let i;try{i=yield un(t.transaction)}catch(u){console.error(u,"sign error");let{message:s}=u,r=E?$(u).errorMessage:null;B(),ln(r!=null?r:s);return}if(!i)return;let m={[c]:i},d=T?o(o({},T),m):m;if(G(d),!O){p(u=>u+1),F(!1);return}if(!d)return;let g=Object.values(d);!R({isGuarded:M,transactions:g})&&cn||(k(g),B())}),Tn=()=>N(void 0,null,function*(){try{if(t==null)return;if(t.transaction.getSignature().toString("hex")&&!O){p(e=>e+1);return}yield H()}catch(n){console.error("Error during signing transaction"),yield H()}}),mn=c===0,Sn=()=>{mn?f==null||f():p(n=>n-1)},Y=Boolean(((z=t==null?void 0:t.transactionTokenInfo)==null?void 0:z.type)&&((J=t==null?void 0:t.transactionTokenInfo)==null?void 0:J.multiTxData)&&!(t!=null&&t.dataField.endsWith((K=t==null?void 0:t.transactionTokenInfo)==null?void 0:K.multiTxData)));return{allTransactions:h,onSignTransaction:()=>N(void 0,null,function*(){if(Y){p(n=>n+1);return}yield Tn()}),onNext:()=>{p(n=>{let e=n+1;return e>(l==null?void 0:l.length)?n:e})},onPrev:()=>{p(n=>{let e=n-1;return e<0?n:e})},waitingForDevice:dn,onAbort:Sn,isLastTransaction:O,isFirstTransaction:c===0,hasMultipleTransactions:l.length>1,shouldContinueWithoutSigning:Y,currentStep:c,signedTransactions:T,setSignedTransactions:G,updatePPU:fn,currentTransaction:t}};export{_n as a};
//# sourceMappingURL=chunk-5M6N3KME.js.map
