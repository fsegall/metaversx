import{a as G}from"./chunk-5C4GAWRH.js";import{a as x}from"./chunk-Q2AR5236.js";import{a as W}from"./chunk-4ZTSYZ6M.js";import{a as _}from"./chunk-MA3ZRSMB.js";import{a as R,b as ro}from"./chunk-NYCEZZHS.js";import{a as D}from"./chunk-WXDNXHED.js";import{c as M,d as N}from"./chunk-KLQ5IZ6C.js";import{a as O,b as P}from"./chunk-PVNL3U3S.js";import{i as E,o as no}from"./chunk-S55DZJQR.js";import{a as eo}from"./chunk-MPMLX57E.js";import{a as f,c as p,d as U}from"./chunk-7UBLQIEN.js";import{b as v,c as b}from"./chunk-6NZ6PUBT.js";import{h as k,j as Z}from"./chunk-7YHU2LQD.js";import{a as A,b as oo}from"./chunk-OWBHRN3S.js";import{a as Y}from"./chunk-JAKKMAZG.js";import{a as m,b as w,j as h,m as S}from"./chunk-HBP5N4FR.js";S();import{useState as C}from"react";Z();b();no();eo();Y();ro();oo();var Ao=({callbackRoute:i,token:F,nativeAuth:l,walletAddress:s})=>{let[d,L]=C(""),[H,a]=C(!1),$=l!=null,g=x(l),o=F,z=N(E),n=M(),u=G();function B(){return h(this,arguments,function*(y=P.metamask){if(u)throw new Error(k);W({skipLoginMethod:"iframe"}),n(U(f.address)),n(p(f)),a(!0);let e=O.getInstance(),I=s!=null?s:z.metamaskSnapWalletAddress;if(!I){L("Iframe snap wallet URL is not set");return}e.setLoginType(y),e.setWalletUrl(I);let j=yield e.init();try{if(!j){console.warn("Something went wrong trying to redirect to wallet login..");return}let{origin:r,pathname:q}=A(),J=encodeURIComponent(`${r}${i!=null?i:q}`);if($&&!o&&(o=yield g.getNativeAuthLoginToken(),!o)){console.warn("Fetching block failed. Login cancelled.");return}o&&g.setLoginToken(o);let K=m({callbackUrl:J},o&&{token:o}),{signature:Q,address:T,multisig:V,impersonate:X}=yield e.login(K);if(D(e),!T){a(!1),console.warn("Login cancelled.");return}let t=yield _({loginToken:o,extraInfoData:{multisig:V,impersonate:X},address:T,signature:Q,loginService:g});if(!t)return;n(v({address:t.address,loginMethod:"iframe",iframeLoginType:y})),n(p(w(m({},t),{nonce:R(t)})))}catch(r){console.error("error loging in",r),L("error logging in"+r.message)}finally{a(!1)}})}let c=Boolean(d);return[B,{loginFailed:c,error:d,isLoading:H&&!c,isLoggedIn:u&&!c}]};export{Ao as a};
//# sourceMappingURL=chunk-4XPSKHOY.js.map
