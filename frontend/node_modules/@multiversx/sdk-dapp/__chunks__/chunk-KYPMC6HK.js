import{a as O}from"./chunk-5C4GAWRH.js";import{a as E}from"./chunk-Q2AR5236.js";import{a as U}from"./chunk-4ZTSYZ6M.js";import{a as P}from"./chunk-WXDNXHED.js";import{c as A}from"./chunk-KLQ5IZ6C.js";import{a as q}from"./chunk-MPMLX57E.js";import{a as l,c as k,d as h}from"./chunk-7UBLQIEN.js";import{a as j}from"./chunk-Z3FCAX26.js";import{a as M}from"./chunk-75SQ7UW4.js";import{a as v,c as S}from"./chunk-K5Y5PIZE.js";import{a as w}from"./chunk-7XYHQ72T.js";import{b as I,c as b}from"./chunk-6NZ6PUBT.js";import{h as T,j as B}from"./chunk-7YHU2LQD.js";import{p as R}from"./chunk-EOZJRV5E.js";import{a as L,j as u,m as y}from"./chunk-HBP5N4FR.js";y();B();import{useState as C}from"react";import{MetamaskProvider as J}from"@multiversx/sdk-metamask-provider/out/metamaskProvider";b();q();R();j();S();S();var lo=({callbackRoute:e,token:D,nativeAuth:m,onLoginRedirect:F})=>{let[d,p]=C(""),[N,t]=C(!1),G=m!=null,r=E(m),o=D,s=A(),f=O();function _(){return u(this,null,function*(){if(f)throw new Error(T);U(),s(h(l.address)),s(k(l)),t(!0);let n=J.getInstance();try{if(!(yield n.init())){console.warn("Something went wrong trying to redirect to wallet login..");return}let x=v(),z=encodeURIComponent(w(e!=null?e:x));if(G&&!o&&(o=yield r.getNativeAuthLoginToken(),!o)){console.warn("Fetching block failed. Login cancelled.");return}o&&r.setLoginToken(o);let H=L({callbackUrl:z},o&&{token:o});yield n.login(H),P(n);let{signature:c,address:i}=n.account;if(!i){t(!1),console.warn("Login cancelled."),p("Login cancelled");return}c&&o&&r.setTokenLoginInfo({signature:c,address:i}),s(I({address:i,loginMethod:"metamask"})),M({callbackRoute:e,onLoginRedirect:F,options:{signature:c,address:i}})}catch(g){console.error("error logging in",g),p("error logging in"+g.message)}finally{t(!1)}})}let a=Boolean(d);return[_,{loginFailed:a,error:d,isLoading:N&&!a,isLoggedIn:f&&!a}]};export{lo as a};
//# sourceMappingURL=chunk-KYPMC6HK.js.map
